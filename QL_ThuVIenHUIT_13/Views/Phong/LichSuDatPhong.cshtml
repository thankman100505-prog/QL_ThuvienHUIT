@using QL_ThuVIenHUIT_13.Models
@model IEnumerable<PHIEU_MUONPHONG>
@{
    ViewBag.Title = "Lịch sử đặt phòng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int stt = 1;
    DateTime now = DateTime.Now;
}

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: #fff;
    }

    th, td {
        border: 1px solid #000;
        padding: 8px;
        text-align: center;
    }

    th {
        background: #f0f0f0;
    }

    tbody tr:nth-child(even) {
        background-color: #F2F3F4;
    }

    .status-ok {
        color: #2ecc71;
        font-weight: bold;
        font-size: 20px;
    }

    .status-no {
        color: #e74c3c;
        font-weight: bold;
        font-size: 20px;
    }

    .action img {
        width: 18px;
        height: 18px;
        cursor: pointer;
        object-fit: contain;
    }

    .action {
        display: flex;
        justify-content: center;
        gap: 10px;
    }
</style>

<h2 style="text-align:center">DANH SÁCH CÁC PHÒNG ĐANG ĐẶT</h2>

<table>
    <thead>
        <tr>
            <th>STT</th>
            <th>Tên phòng</th>
            <th>Phòng</th>
            <th>Thời gian</th>
            <th>Ngày</th>
            <th>Đã xong</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            DateTime? ngay = item.NGAYMUON;
            TimeSpan? gioTra = item.GIOTRA;
            bool hoanTat = ngay.HasValue && gioTra.HasValue &&
                (ngay.Value.Date + gioTra.Value) <= now;

            <tr>
                <td>@stt</td>
                <td>@item.MAPH</td>
                <td>
                    @(item.GIOMUON.HasValue ? item.GIOMUON.Value.ToString(@"hh\:mm") : "--") -
                    @(item.GIOTRA.HasValue ? item.GIOTRA.Value.ToString(@"hh\:mm") : "--")
                </td>
                <td>@(ngay.HasValue ? ngay.Value.ToString("dd/MM/yyyy") : "")</td>
                <td>
                    @if (hoanTat)
                    {<span class="status-ok">✓</span> }
                    else
                    { <span class="status-no">✗</span>}
                </td>
                <td class="action">
                    <a href="@Url.Action("SuaDatPhong", "Phong", new { id = item.MAPHIEU })">
                        <img src="~/Content/images/edit.png" alt="Sửa" />
                    </a>
                    <a href="@Url.Action("XoaDatPhong", "Phong", new { id = item.MAPHIEU })"
                       onclick="return confirm('Bạn có chắc chắn muốn xóa phiếu này?');">
                        <img src="~/Content/images/bin (1).png" alt="Xóa" />
                    </a>
                </td>
            </tr>
            stt++;
        }
    </tbody>
</table>